## V8 工作原理与实践.
要深入理解 V8 的工作原理，你需要搞清楚一些概念和原理，比如: 编译器,解释器,抽象语法树(AST),字节码(Bytecode),即使编译器(JIT) 等概念.

> 编译器和解释器

```
 之所以存在编译器和解释器，是因为机器不能直接理解我们所写的代码, 所以在执行程序之前, 需要将我们手写的代码“翻译”成机器能读懂的机器语言. 按语言的执行流程,可以把语言划分为编译型语言和解析型语言.
```

编译型语言在程序执行之前,需要经过编译器的编译过程,并且编译之后会直接保留机器能读懂的二进制文件，这样每次运行程序时，都可以执行运行文件，而不需要再次重新编译了. 比如c/c++,Go 等多是编译型语言.

而由解析型语言编写的程序, 在每次运行时都需要通过解释器对程序进行动态解释和执行. 比如Python,Javascript 等都属于解释型语言.

编译器:
源代码=>AST=>中间代码=>二进制文件=>执行.

解释器:
源代码 => AST => 字节码 => 执行.

1、在编译型语言的编译过程中,编译器首先会依次对源代码进行词法分析、语法分析、生成抽象语法树(AST), 然后优化代码,
最后在生成处理器能够理解的机器码.

2、在解释性语言的解释过程中, 同样解释器也会对源代码进行词法分析、语法分析,并生成抽象语法树(AST), 不过它会再基于抽象语法树生成字节码，最后在根据字节码来执行程序、输出结果.

> V8 是如何执行一段Javascript 代码的.

V8 既有解析器又有编译器.
1、生成抽象语法树(AST) 和执行上下文.

AST 的结构和代码的结构非常相似, 其实你可以把AST看成代码的结构化的表示,编译器或者解释器后续的工作
都需要依赖于AST,而不是源代码.

Babel 是一个被广泛使用的代码转换器，可以将ES6 转换为ES5 代码, 者意味着你可以就使用ES6 编写程序, 而不用担心现有环境
是否支持ES6。 Babel 的工作原理是先将 ES6 编写程序, 而不用担心现有环境是否支持ES6。 Babel 的工作原理就是先将ES6 d 
源码转换为AST, 然后再将ES6 语法的AST 转换为 ES5 的语法的AST。 在利用ES5 的AST 生成 Javascript 源代码.

2、什么是AST 以及 AST 生成的过程是怎样的?

 第一阶段是分词.

 第二阶段是解析.

3、生成字节码.
有了 AST 和 执行上下文后, 那接下来的第二步，解释器 Ignition 就登场了,它会根据AST 生成字节码, 并解释执行字节码.

其实一开始V8 并没有字节码, 而是直接将AST 转换为 机器码，由于执行机器码的效率是非常高效的, 所以这种方式在发布后
的一段时间内效果非常好的。但是随着Chrome 在手机上的广泛普及, 特别是运行在512内存的手机上，内存占用也暴露出来了，因为
V8 需要消耗大量的内存来存放转换后的机器码。 为了解决内存占用的问题，V8 团队大幅重构了引擎架构，引入字节码，并且
抛弃了之前的编译器，最终花了四年时间。

字节码就是介于AST 和 机器码之间的一种代码. 但是与特定类型的机器码无关，字节码需要通过解释器将其转换为机器码后才能执行.

机器码所占用的空间远远超过了字节码，所以使用字节码可以减少系统的内存使用.

4、执行代码.
生成字节码之后,接下来就要进入执行阶段了.

V8 的解释器和编译器的取名也很有意思. 解释器Ignition 是点火器的意思, 编译器 TurboFan 是涡轮增压的意思。

寓意是代码启动时通过点火器慢慢发动，一旦启动，涡轮增压介入.
JIT 即时编译.

JavaScript 性能优化.
1、提升单次脚本的执行速度,避免Javascript 的长任务霸占主线程, 这样可以使得页面快速响应交互.
2、避免大的内联脚本,因为解析HTML的过程中,解析和编译也会占用主进程.
3、减少JavaScript 文件的内容,因为更小的文件会提升下载速度,并且占用更低的内存.



 
 







 


